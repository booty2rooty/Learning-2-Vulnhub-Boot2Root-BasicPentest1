# VulnHub - Basic Pentesting: 1

[Link to machine](https://www.vulnhub.com/entry/basic-pentesting-1,216/)

**Machine Description from the author:**

_This is a small boot2root VM I created for my university’s cyber security group. It contains multiple remote vulnerabilities and multiple privilege escalation vectors. I did all of my testing for this VM on VirtualBox, so that’s the recommended platform. I have been informed that it also works with VMware, but I haven’t tested this personally._

_This VM is specifically intended for newcomers to penetration testing. If you’re a beginner, you should hopefully find the difficulty of the VM to be just right._

_**Your goal is to remotely attack the VM and gain root privileges.** Once you’ve finished, try to find other vectors you might have missed! If you enjoyed the VM or have questions, feel free to contact me at: josiah@vt.edu_

_If you finished the VM, please also consider posting a writeup! Writeups help you internalize what you worked on and help anyone else who might be struggling or wants to see someone else’s process. I look forward to reading them!*_


# Introduction

This is my 2nd purposefully vulnerable machine that I am practising on. From my previous experience, I have taken a step back to gain more knowledge and muscle memory on the effective usage of **nmap** and **Nessus** through the learning rooms on TryHackMe and the free cybersecurity course on INE.

This write-up serves as a documentation of my learning journey towards gaining more knowledge and hands-on experience into penetration testing.

I have read through a few guides ahead of time to prepare myself for the tasks at hand, and will attempt to navigate through the challenge as best as I can without referring back to the guides until I get stuck again.

Additionally, for the sake of proper / neat reading format on Github, I am attempting to write this documentation using Notepad++ with a markdown editor plugin.

**Guides used:**

1. [https://medium.com/syscall59/basic-pentesting-1-walkthrough-vulnhub-5a15074c4f7](https://medium.com/syscall59/basic-pentesting-1-walkthrough-vulnhub-5a15074c4f7)
2. [https://blog.razrsec.uk/basic-pentesting-1-walkthrough/](https://blog.razrsec.uk/basic-pentesting-1-walkthrough/)


# VM Environment

**Attacking Machine**: Kali 2021.1

**Network**: VirtualBox internal network. 10.10.10.0/24 / DHCP Range 10.10.10.100-150


# Information Gathering

My first step was to attempt to gather as much information as possible to increase the attack surface.

I started with a simple nmap scan using -sn on the internal network to get the IP address of the machine, followed by a SYN scan of the target of all ports to discover the services running:

![01](https://user-images.githubusercontent.com/82624344/115237777-89b8a580-a14f-11eb-9b0e-5f7a4816b206.jpg)

I then performed a more in-depth scan using nmap again to get additional information from my results above (using -sC for default "safe" scripts, -sV to query version the services are running on, and -O for OS discovery):

![02](https://user-images.githubusercontent.com/82624344/115237788-8de4c300-a14f-11eb-86d6-9b0cd9ff1db4.jpg)

**Information gathered:**

1. Target IP is 10.10.10.105
2. Port 21 is running an FTP daemon called ProFTPD 1.3.3c
3. Port 22 is running OpenSSH 7.2p2 on a Ubuntu host
4. Port 80 is running a web service using Apache/2.4.18

**Learning notes**

- Always good to expand the attack surface as much as possible initially to understand the target
- TryHackMe and INE state that using --verbose for nmap scan is considered good practice
- Adding on from the above, it is always a good idea to output the file during a scan to prevent unnecessary multiple scans in case I forget the information as I progress further 


# Vulnerability Assessment

Using **searchsploit** as a method for quick assessment, I see that port 21 would be the easiest way to break into the machine using a known exploit, and I might be able to enumerate usernames using SSH on port 22 to brute force later on:

![03](https://user-images.githubusercontent.com/82624344/115237800-91784a00-a14f-11eb-86a5-fe29d2bf335e.jpg)

While the web service doesn't seem to yield anything interesting at first glance:

![04](https://user-images.githubusercontent.com/82624344/115237818-96d59480-a14f-11eb-9983-1d735c790c3d.jpg)

I used **gobuster** to attempt to find any hidden directories and found /secret, and followed it up using *dirb* to further explore that directory, which told me it's hosting a WordPress Server:

![05](https://user-images.githubusercontent.com/82624344/115237842-9ccb7580-a14f-11eb-92ea-f0f8f61f9a18.jpg)

![06](https://user-images.githubusercontent.com/82624344/115237846-9dfca280-a14f-11eb-8d1d-825b71dc563e.jpg)

**Attack surfaces to consider**

1. Exploit ProFTPD 1.3.3c using Metasploit
2. Find for users via SSH
3. Explore the WordPress server for more information

**Learning notes**

- Web servers might contain additional information and / or a possible method of entry if explored further, even if the initial source code doesn't yield anything interesting
- using **gobuster**, followed by **dirb** is an easy way to spider through a site to gain additional information on a target web server


# Enumeration

I first attempted to locate any usernames I could possibly use via Metasploit (/auxiliary/scanner/ssh/ssh_enumusers), this didn't return any promising information I thought could be use to me at the current moment:

![07](https://user-images.githubusercontent.com/82624344/115237872-a81ea100-a14f-11eb-888c-b40ad15e9dce.jpg)

I then used **wpscan --url http://10.10.10.105/secret/ --enumerate u** to firstly enumerate for usernames which could be used for any upcoming attack attempts, which showed that username "admin" could be used:

![08](https://user-images.githubusercontent.com/82624344/115237888-aa80fb00-a14f-11eb-9611-c3be1d739fb6.jpg)

I then attempted to brute force into the WordPress admin console using **wpscan --url 10.10.10.105/secret -U admin -P rockyou.txt**, which yield a result (admin/admin):

![09](https://user-images.githubusercontent.com/82624344/115237899-ace35500-a14f-11eb-8b48-ce5a6f9487bd.jpg)

![10](https://user-images.githubusercontent.com/82624344/115237915-afde4580-a14f-11eb-8d35-e3166be7ba8f.jpg)

**Additional information gathered:**

1. I now have 2 methods of attacking
2. First through Metasploit using the ProFTPD backdoor exploit
3. And through the WordPress admin console

**Learning notes**

- Enumerating users through the ssh_enumusers module may or may not be a truly practical approach for real-world situations
- That said, Metasploit has a lot of width and depth that I still need to explore more
- WPScan is a very useful tool for WordPress blogs. Will also need to read further on how to use it effectively in other scenarios
- Weak login credentials may or may not be a common occurrence in real-world
- Brute force methods seem  to be the easiest way to find a way into a system


# Exploitation - ProFTPD 1.3.3c

My first attack vector will be exploiting the **ProFTPD 1.3.3c backdoor** using Metasploit. At my current knowledge level, I do not really understand how most exploits really work at the moment, other than run > exploit > profit.

1. **sudo msfconsole** to run Metasploit
2. **search 1.3.3c** to search for the specific exploit I intend to use
3. **show payloads** to bring up a menu of the available options I have to use with the exploit
4. **set** my respective options for the exploit module and payload
5. **run** to execute them

![11](https://user-images.githubusercontent.com/82624344/115237937-b7055380-a14f-11eb-9a38-e78e268c75bc.jpg)

I now have a working reverse shell with root access and privileges:

![12](https://user-images.githubusercontent.com/82624344/115237951-ba98da80-a14f-11eb-9a1b-91056e84c189.jpg)


# Exploitation - WordPress Admim

My next attempt was to use Metasploit again, along with the credentials I obtained from my earlier WPScan brute force:

![13](https://user-images.githubusercontent.com/82624344/115237966-bd93cb00-a14f-11eb-9862-6861568fae8c.jpg)

With a working reverse shell, I get my bearings by first performing **whoami ; id ; sudo -l ; pwd** to check for the permissions levels granted to the user I have been logged in with, which was www-data.

I see that I do not have sudo privileges, and used **ls -la /** to scan for folders which allowed me read/write permissions on the target machine. This returned the result that /tmp had what I was looking for:

![14](https://user-images.githubusercontent.com/82624344/115237981-c1275200-a14f-11eb-9504-f08b71600e25.jpg)

![15](https://user-images.githubusercontent.com/82624344/115237986-c1bfe880-a14f-11eb-8578-1085ce30a187.jpg)

I then proceeded to upload a privilege escalation checking script? called **unix-privsec-check** that comes with Kali to the target machine /tmp directory, and used **chmod -x** to enable execution of the file:

![16](https://user-images.githubusercontent.com/82624344/115238022-ca182380-a14f-11eb-8ed6-987ef13343ac.jpg)

I spent the next few hours trying to figure out what I was doing wrong to get this error that I kept getting for the script below. After ALOT of Google-fu, I found that the issue might be [needing to change the "==" to "="](https://stackoverflow.com/questions/3411048/unexpected-operator-in-shell-programming#comment32805085_3411061) on line 1076, but unfortunately, that still didn't return any usable information.

I relooked at the guides and am sure something isn't right somewhere, since both mentioned that I should be getting an output that says **World write is set for /etc/passwd**. 

![17](https://user-images.githubusercontent.com/82624344/115238066-d603e580-a14f-11eb-9fe5-3995bffcd225.jpg)

![18](https://user-images.githubusercontent.com/82624344/115238070-d7351280-a14f-11eb-800d-3fcedc5d9dfb.jpg)

![19](https://user-images.githubusercontent.com/82624344/115238072-d7cda900-a14f-11eb-8134-a2b0e4b34bc7.jpg)

Being unable to sleep and getting increasing frustrated because I cannot approach a solution that is known to work, I looked for other avenues on how to approach this using a different approach.

I eventually found [Linenum](https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh) and proceeded to repeat my failed steps from using PentestMonkey's script:

![20](https://user-images.githubusercontent.com/82624344/115238096-def4b700-a14f-11eb-8a43-b7d37ce49e47.jpg)

Which gave me something I felt I could work with (after all, if something is highlighted brightly, there must be a reason for the author to do so). The results also showed me that marlinspike has sudo / admin rights:

![21](https://user-images.githubusercontent.com/82624344/115238113-e320d480-a14f-11eb-9f41-eb105d921b01.jpg)

![22](https://user-images.githubusercontent.com/82624344/115238116-e3b96b00-a14f-11eb-8fee-978d1870a099.jpg)

The results shows me that there is a user called **"marlinspike**, and being able to read the shadow file means I am able to obtain the password hash.

After more research and high-level reading for understanding, I stumbled upon [this article](https://null-byte.wonderhowto.com/how-to/crack-shadow-hashes-after-getting-root-linux-system-0186386/) which pointed to me that I could use a tool called **John the Ripper** on my Kali machine to decrypt the password hash and hopefully obtain the user's login credentials:

I started by:

1. creating a file with the user's password hash (marlin)
2. running **john** on the newly created file to unencrypt the password
3. used **john --show marlin** to get the cracked password

I now know that I can log into the machine use marlinspike / marlinspike!

![23](https://user-images.githubusercontent.com/82624344/115238134-eae07900-a14f-11eb-9ed9-ccf6f613d991.jpg)

Armed with this new information, and the promise of finally being able to get some sleep, I connected to the target machine using SSH (since I knew that service was already running from my initial nmap scan) using the credentials and got root access from there!

![24](https://user-images.githubusercontent.com/82624344/115238143-eddb6980-a14f-11eb-8293-eb784c6cc3f4.jpg)

**Exploitation Learning notes:**

- **Reverse shell** is mechanism that allow you to have the server shell by exploiting the web server to trigger a connection back to the server, and will create a listening server that waiting for the connection from the server

- The Metasploit module **wp_admin_shell_upload** gives remote authenticated attackers the ability to upload backdoor payloads by utilizing the WordPress plugin upload functionality. The module sends crafted multipart upload requests to /wp-admin/update.php, resulting in backdoor code execution on the target host

- The attacker uses previously obtained WordPress user credentials to access the WordPress administrator backend and upload a malicious plugin via HTTP request to /wp-admin/update.php. WordPress then installs the provided plugin and offers public access to the installed files

- **Meterpreter** is a Metasploit attack payload that provides an interactive shell from which an attacker can explore the target machine and execute code

- **Enumeration** is defined as the process of extracting user names, machine names, network resources, shares and services from a system. The gathered information is used to identify the vulnerabilities or weak points in system security and tries to exploit in the System gaining phase

- **Privilege escalation** happens when a malicious user exploits a bug, design flaw, or configuration error in an application or operating system to gain elevated access to resources that should normally be unavailable to that user

- Attackers start by exploiting a privilege escalation vulnerability in a target system or application, which lets them override the limitations of the current user account. They can then access the functionality and data of another user (horizontal privilege escalation) or obtain elevated privileges, typically of a system administrator or other power user (vertical privilege escalation). Such privilege escalation is generally just one of the steps performed in preparation for the main attack

- A couple files of particular interest on Linux systems are the **/etc/passwd** and **/etc/shadow files**. The /etc/passwd file contains basic information about each user account on the system, including the root user which has full administrative rights, system service accounts, and actual users

- The **/etc/shadow** file contains the encrypted passwords of users on the system. While the /etc/passwd file is typically world-readable, the /etc/shadow is only readable by the root account. The shadow file also contains other information such as password expiration dates


# Post-exploitation

One thing I've come across multiple times while doing my own reading is that hackers will leave some kind of backdoor for persistency. I decided to do the same as well by creating a new user with sudo privileges as well (booty2rooty / password):

![25](https://user-images.githubusercontent.com/82624344/115238166-f633a480-a14f-11eb-89c5-919ed26398cd.jpg)


# Conclusion

The theme of this machine seems to be weak passwords as an entry point, and was actually quite a lot of fun. Reverse shell and privilege escalation was some words that I have always come across during my reading, but I never had the opportunity to explore further.

Learning how to use tools new to me, such as WPScan, John the Ripper and Metasploit, also contributed to the fun from this experience. I also felt that the additional time I spent learning about nmap previously is starting to pay off, since I no longer have to look up a cheat sheet each time I want to try a different scan type, or not know what scans to use in the first place.

Furthermore, gaining access and escalating privileges to and from the marlinspike account in my own way was ***immensely*** satisfying.

As always, I'd like to thank the authors of the walk-throughs for their time and effort, which has directly helped me in furthering my understanding and refined my thought process on penetration testing, even if just by a little.

# Research and Reading Material References

- [https://www.hackingarticles.in/wordpress-reverse-shell/](https://www.hackingarticles.in/wordpress-reverse-shell/)
- [https://support.alertlogic.com/hc/en-us/articles/360002627912-Authenticated-WordPress-Admin-Shell-Upload](https://support.alertlogic.com/hc/en-us/articles/360002627912-Authenticated-WordPress-Admin-Shell-Upload)
- [https://rioasmara.com/2019/02/25/penetration-test-wordpress-reverse-shell/](https://rioasmara.com/2019/02/25/penetration-test-wordpress-reverse-shell/)
- [https://doubleoctopus.com/security-wiki/threats-and-tools/meterpreter/](https://doubleoctopus.com/security-wiki/threats-and-tools/meterpreter/)
- [https://www.netsparker.com/blog/web-security/privilege-escalation/](https://www.netsparker.com/blog/web-security/privilege-escalation/)
-[https://www.greycampus.com/opencampus/ethical-hacking/enumeration-and-its-types](https://www.greycampus.com/opencampus/ethical-hacking/enumeration-and-its-types)
